<template>
  <div>
    <el-row :gutter="10">
      <el-col :span="24">
        <el-card>
          <FullCalendar :options="calendarOptions" />
        </el-card>
      </el-col>
    </el-row>

    <!-- 值班弹窗Form -->
    <el-button text @click="dialogFormVisible = true">
      open a Form nested Dialog
    </el-button>

    <el-dialog v-model="dialogFormVisible" title="Shipping address">
      <el-form :model="form">
        <el-form-item label="Promotion name" :label-width="formLabelWidth">
          <el-input v-model="form.name" autocomplete="off" />
        </el-form-item>
        <el-form-item label="Zones" :label-width="formLabelWidth">
          <el-select v-model="form.region" placeholder="Please select a zone">
            <el-option label="Zone No.1" value="shanghai" />
            <el-option label="Zone No.2" value="beijing" />
          </el-select>
        </el-form-item>
      </el-form>
      <template #footer>
        <span class="dialog-footer">
          <el-button @click="dialogFormVisible = false">Cancel</el-button>
          <el-button type="primary" @click="dialogFormVisible = false">
            Confirm
          </el-button>
        </span>
      </template>
    </el-dialog>
  </div>
</template>

<script setup>
import { reactive, ref } from 'vue'

const dialogTableVisible = ref(false)
const dialogFormVisible = ref(false)
const formLabelWidth = '140px'

const form = reactive({
  name: '',
  region: '',
  date1: '',
  date2: '',
  delivery: false,
  type: [],
  resource: '',
  desc: '',
})

const gridData = [
  {
    date: '2016-05-02',
    name: 'John Smith',
    address: 'No.1518,  Jinshajiang Road, Putuo District',
  },
  {
    date: '2016-05-04',
    name: 'John Smith',
    address: 'No.1518,  Jinshajiang Road, Putuo District',
  },
  {
    date: '2016-05-01',
    name: 'John Smith',
    address: 'No.1518,  Jinshajiang Road, Putuo District',
  },
  {
    date: '2016-05-03',
    name: 'John Smith',
    address: 'No.1518,  Jinshajiang Road, Putuo District',
  },
]
</script>

<script>
import tippy from "tippy.js"
import 'tippy.js/dist/tippy.css'
import 'bootstrap/dist/css/bootstrap.css'
import 'bootstrap-icons/font/bootstrap-icons.css'
import '@fullcalendar/core/vdom'
import FullCalendar from '@fullcalendar/vue3'
import listPlugin from '@fullcalendar/list'
import rrulePlugin from '@fullcalendar/rrule'
import dayGridPlugin from '@fullcalendar/daygrid'
import timeGridPlugin from '@fullcalendar/timegrid'
import interactionPlugin from '@fullcalendar/interaction'
import zhCnLocale from '@fullcalendar/core/locales/zh-cn'
import bootstrap5Plugin from '@fullcalendar/bootstrap5'

export default {
  name: 'onCall',
  components: {
    FullCalendar
  },
  data() {
    return {
      calendarOptions: {
        plugins: [
          rrulePlugin,
          listPlugin,
          dayGridPlugin,
          timeGridPlugin,
          interactionPlugin,
          bootstrap5Plugin,
        ],
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
        },
        themeSystem: 'bootstrap5',
        locale: zhCnLocale,
        timeZone: 'local',
        initialView: 'dayGridMonth',  // 初始化插件显示
        firstDay: '1',                // 设置一周中显示的第一天是周几，周日是0，周一是1，以此类推
        weekNumberCalculation: 'ISO', // 与firstDay配套使用
        handleWindowResize: true,     // 随浏览器窗口变化 
        droppable: true,              // 是否可拖动
        editable: true,               // 确定是否可以修改日历上的事件。
        selectable: true,             // 允许用户通过单击和拖动来突出显示多天或多个时隙。
        selectMirror: true,           // 用户拖动时是否绘制“占位符”事件。
        dayMaxEvents: true,           // 给定日期内的最大活动数，不包括+ more链接。其余的将显示在弹出窗口中。如果true已指定，则事件数将限制为日单元格的高度。
        weekends: true,               // 是否显示周末，设为false则不显示周六和周日。默认值为true
        navLinks: true,               // 点击日期跳转
        // weekNumbers: true,         // 是否显示周数
        // https://fullcalendar.io/docs/event-object
        // resources: 'https://fullcalendar.io/api/demo-feeds/resources.json?with-nesting&with-colors',
        // events: 'https://fullcalendar.io/api/demo-feeds/events.json?single-day&for-resource-timeline',
        events: [
          {
            id: 11,
            title: '任务1',
            start: '2022-11-01',
            end: '2022-11-05',
            user: 'zhengfuqiang'
            // color: '#ffcc99',
            // editable: true, //允许拖动缩放，不写默认就是false
            // overlap: true, //允许时间重叠，即可以与其他事件并存，不写默认就是false
          },
          {
            groupId: 'blueEvents', // recurrent events in this group move together
            daysOfWeek: ['4'],
            startTime: '10:45:00',
            endTime: '12:45:00'
          },
          {
            groupId: 'group-id-1',
            daysOfWeek: ['3'], // these recurrent events move separately
            startTime: '10:00:00',
            endTime: '18:00:00',
            color: 'red'
          },
          // {
          //   title: 'rrule event',
          //   // groupId: 'Events-123',
          //   rrule: {
          //     freq: 'daily',
          //     interval: 1,
          //     count: 3,
          //     // byweekday: ['zh-cn'],
          //     dtstart: '2022-11-11', // will also accept '20120201T103000'
          //     until: '2022-11-16' // will also accept '20120201'
          //   }
          // },
          // {
          //     id: 12,
          //     title: '任务2',
          //     start: '2022-11-07',
          //     end: '2022-11-15',
          //     color: '#970707',
          // },
          // {
          //     title: 'Meeting',
          //     start: '2022-11-07T14:30:00',
          //     extendedProps: {
          //         status: 'done'
          //     }
          // },
          // {
          //     title: 'Birthday Party',
          //     start: '2022-11-13T07:00:00',
          //     backgroundColor: 'green',
          //     borderColor: 'green'
          // },
        ],
        select: this.handleDateSelect,
        eventsSet: this.handleEvents,
        eventClick: this.handleEventClick,
        eventMouseEnter: this.handleEventMouseEnter,
      }
    }
  },
  methods: {
    // 监听事件变化
    handleEvents(events) {
      console.log(events, 'eventsSet...');
    },
    handleEventClick(info) {
      if (confirm(`请确认删除事件： '${info.event.title}'`)) {
        info.event.remove()
      }
    },
    //点击日期
    handleDateSelect(info) {
      let title = prompt('Please enter a new title for your event')
      let calendarApi = info.view.calendar
      calendarApi.unselect() // clear date selection
      if (title) {
        calendarApi.addEvent({
          id: 111,
          title,
          start: info.startStr,
          end: info.endStr,
          allDay: info.allDay
        })
      }
    },
    // 鼠标悬浮
    handleEventMouseEnter(info) {
      const content = `
        <b> ${info.event.title} </b> <br/>
        <p>
          <b> 值班人员 </b>: ${info.event.extendedProps.user} </br>
          <b> 开始时间 </b>: ${info.event.start}  </br>
          <b> 结束时间 </b>: ${info.event.end} </br>
        </p>`
      console.log(info.event);
      tippy(info.el, {
        content: content,
        interactive: true,      // 可交互的
        placement: 'right-end', // 悬浮框位置
        allowHTML: true         // 是否允许html文本
      });
    },
  },
}
</script>
<style lang='css'>

</style>